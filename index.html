<!doctype html>
<html >
  <head>
    <meta charset="utf-8">
    <title>行政機關辦公日曆</title>
    <meta name="description" content="中華民國，政府，行政，機關，辦公日曆">
	<meta name="keywords" content="行政機關辦公日曆表">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />	
	<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.0/fullcalendar.min.css" />
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.0/fullcalendar.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.0/locale/zh-tw.js"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<style type="text/css">
    //.fc-day-grid-event .fc-content{ white-space: normal!important; }
   //.fc-today { background: pink !important;}
	.fc-widget-header .fc-sat,
	.fc-widget-header .fc-sun{
		color:red;
	}
	h2 {
		text-align: center;
	}
		.fc-toolbar.fc-header-toolbar{margin-bottom:0!important }
	  .fc-today{   
    font-weight: bold;
    font-size:1.25em;
    }	
  </style>
  <script>

$(document).ready(function(){
	
	      
	
	//open data 人事總處行事曆Json
//var site = "https://data.ntpc.gov.tw/api/datasets/308DCD75-6434-45BC-A95F-584DA4FED251/json?page=1&size=800";
var url = "cal.json";
  
    //"382000000A-000077-002.json";
	
var holidays = [];
var holidayStr = function(item){				
  return  { 
          title : item.name,
          start  : item.date,
          allDay: true,
   	      backgroundColor : "pink",
          borderColor: "pink"
     		 };
 }
 
var workdayStr = function(item){
	return		{ 
		  title : item.holidayCategory,
		  start  : item.date,
		  allDay: true,
		  textColor: "black",
		  backgroundColor : "white",
		  borderColor: "white"
	      };
}
 
//var workdayStr = function(item){
//	return		{ 
//		  title : item.holidayCategory,
//		  start  : item.date,
//		  allDay: true,
//		  textColor: "black",
//		  backgroundColor : "white",
//		  borderColor: "white"
//	      };
//}
//jQuery.ajaxPrefilter(function(options) {
//    if (options.crossDomain && jQuery.support.cors) {
//        options.url = 'https://cors-anywhere.herokuapp.com/' + options.url;
//    }
//});

  $.getJSON( url, function(data) {
	  

	  console.log("'load date:' + data);
	  
  for(var i in data) {    

    var item = data[i];   

		if (item.isHoliday=="是")//&&item.holidayCategory!="特定節日")
    {
    	if (item.holidayCategory!="特定節日"){
      	  holidays.push( holidayStr(item) );        
      }else{
      	var myDate= new Date(item.date);	
      	if(myDate.getDay() == 6 || myDate.getDay() == 0)
        	 holidays.push( holidayStr(item) );
         else
         	holidays.push( workdayStr(item) );
      }   
     }else{
		  holidays.push( workdayStr(item) );
	    }
}

  $('#calendar').fullCalendar({
	fixedWeekCount: false,
  	contentHeight: 'auto',
  	viewRender: function(view,element) {
    
    	//民國年月
   		 var curDate = 	$('#calendar').fullCalendar('getDate');
      var months = ",1月,2月,3月,4月,5月,6月,7月,8月,9月,10月,11月,12月".split(",");
      var year = "民國"+ (moment(curDate).format('YYYY') -1911)+"年";
      var mon =months[ moment(curDate).format('M')];
       
  		$('.fc-left').empty().append("<b>"+year+ mon+"</b>");
 		 },
			events: holidays,
    	eventRender: function (event, element, view) { 
        // event.start is already a moment.js object
        // we can apply .format()
        var dateString = event.start.format("YYYY-MM-DD");
        
        if (event.title!="補行上班日"&&event.title!="特定節日")
        $(view.el[0]).find('.fc-day[data-date=' + dateString + ']').css('background-color', 'pink');
        
        $(element).tooltip({title: event.title});   
     }
		});
});
});
  </script>
   </head>
   
    <body>
		<div id='calendar'></div>
	    	<a href="http://data.ntpc.gov.tw/api/v1/rest/datastore/382000000A-000077-002" target="_blank">來源:新北市政府資料開放平台</a>                                     
	</body>

</html>


